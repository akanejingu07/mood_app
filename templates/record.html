<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>今日の記録</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div class="container">
  <h1>今日の気分記録</h1>
  <form method="post">

    <!-- 日付 -->
    <div class="field">
      <label>
        記録する日付
        <input
          type="date"
          name="record_date"
          id="recordDate"
          value="{{ record.date if edit else date }}"
        >
      </label>
    </div>
  
    <!-- 表示用日付 -->
    <p class="date" id="dateDisplay">
      {% if edit %}
        {{ record.date }}（{{ record.weekday }}）
      {% else %}
        {{ date }}（{{ weekday }}）
      {% endif %}
    </p>

    <!-- 天気 -->
    <div class="field">
      <label>今日の天気</label><br>
      <select name="weather">
        <option value="">選択しない</option>
        <option value="晴れ" {% if edit and record.weather == "晴れ" %}selected{% endif %}>晴れ</option>
        <option value="くもり" {% if edit and record.weather == "くもり" %}selected{% endif %}>くもり</option>
        <option value="雨" {% if edit and record.weather == "雨" %}selected{% endif %}>雨</option>
        <option value="雪" {% if edit and record.weather == "雪" %}selected{% endif %}>雪</option>
     </select>
    </div>  

    <!-- 点数 -->
    <input type="range" name="score" min="1" max="10"
          value="{{ record.score if edit else 5 }}"
          oninput="scoreValue.textContent = this.value">
    <span id="scoreValue">
      {{ record.score if edit else 5 }}
    </span>

    <!-- よかったこと -->
    <textarea name="good1" rows="2">{{ record.good1 if record else '' }}</textarea>
    <textarea name="good2" rows="2">{{ record.good1 if record else '' }}</textarea>
    <textarea name="good3" rows="2">{{ record.good1 if record else '' }}</textarea>

    <!-- ★ここが重要 -->
    <button type="submit">
     {% if edit %}更新する{% else %}保存する{% endif %}
    </button>

  </form>

<!-- 削除フォーム（完全に別） -->
{% if edit %}
<form method="post" action="/delete/{{ record.id }}"
      onsubmit="return confirm('この記録を削除しますか？\nこの操作は元に戻せません。');"
      style="margin-top: 16px;">
  <button type="submit" class="delete-btn">
    削除する
  </button>
</form>
{% endif %}

  
  </form>
  <p>
    <a href="/history">これまでの記録を見る</a>
  </p>
  
  <p>
    <a href="/logout">ログアウト</a>
  </p>
  </div>
  <script>
    const dateInput = document.getElementById("recordDate");
    const dateDisplay = document.getElementById("dateDisplay");
  
    const weekdays = ["日", "月", "火", "水", "木", "金", "土"];
  
    dateInput.addEventListener("change", () => {
      if (!dateInput.value) return;
  
      const d = new Date(dateInput.value);
      const weekday = weekdays[d.getDay()];
  
      dateDisplay.textContent = `${dateInput.value}（${weekday}）`;
    });
  </script>
  
</body>
</html>
